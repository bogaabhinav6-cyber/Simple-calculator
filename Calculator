<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>App-Style Calculator</title>
<style>
/* Body and background */
body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #e0e0e5;
    transition: background 0.5s;
}

body.dark {
    background: #1e1e2f;
}

/* Calculator container */
.calculator {
    background: #ffffff;
    border-radius: 20px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    width: 360px;
    max-width: 95%;
    display: flex;
    flex-direction: column;
    padding: 20px;
    transition: background 0.5s;
}

body.dark .calculator {
    background: #2a2a3d;
}

/* Display */
.display {
    background: #f0f0f5;
    color: #000;
    font-size: 2em;
    border-radius: 12px;
    padding: 15px;
    text-align: right;
    margin-bottom: 15px;
    min-height: 60px;
    overflow-x: auto;
    transition: background 0.5s, color 0.5s;
}

body.dark .display {
    background: #3a3a55;
    color: #fff;
}

/* Buttons grid */
.buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
}

.buttons button {
    padding: 20px;
    font-size: 1.5em;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: transform 0.1s, background 0.3s;
    color: #fff;
    background: #6c6c80;
    box-shadow: 0 4px #505060;
}

.buttons button:active {
    transform: translateY(2px);
    box-shadow: 0 2px #505060;
}

.buttons button.operator { background: #ff9500; color: #fff; }
.buttons button.clear { background: #ff5c5c; color: #fff; }
.buttons button.equal { background: #007bff; color: #fff; grid-column: span 1; }

body.dark .buttons button { background: #505070; box-shadow: 0 4px #383850; }
body.dark .buttons button.operator { background: #ffb347; }
body.dark .buttons button.clear { background: #ff6b6b; }
body.dark .buttons button.equal { background: #3399ff; }

/* History panel */
.history {
    margin-top: 15px;
    background: #f0f0f5;
    border-radius: 12px;
    max-height: 150px;
    overflow-y: auto;
    padding: 10px;
    font-size: 0.9em;
    color: #333;
    transition: background 0.5s, color 0.5s;
}

body.dark .history {
    background: #3a3a55;
    color: #fff;
}

/* Theme toggle */
.theme-toggle {
    margin-bottom: 10px;
    cursor: pointer;
    text-align: center;
    color: #007bff;
    font-weight: bold;
}
</style>
</head>
<body>
<div class="calculator">
    <div class="theme-toggle" onclick="toggleTheme()">Toggle Dark/Light Theme</div>
    <div id="display" class="display">0</div>
    <div class="buttons">
        <!-- Row 1 -->
        <button class="clear" onclick="clearDisplay()">C</button>
        <button onclick="appendValue('±')">±</button>
        <button onclick="appendValue('%')">%</button>
        <button onclick="appendValue('/')">÷</button>

        <!-- Row 2 -->
        <button onclick="appendValue('7')">7</button>
        <button onclick="appendValue('8')">8</button>
        <button onclick="appendValue('9')">9</button>
        <button onclick="appendValue('*')">×</button>

        <!-- Row 3 -->
        <button onclick="appendValue('4')">4</button>
        <button onclick="appendValue('5')">5</button>
        <button onclick="appendValue('6')">6</button>
        <button onclick="appendValue('-')">−</button>

        <!-- Row 4 -->
        <button onclick="appendValue('1')">1</button>
        <button onclick="appendValue('2')">2</button>
        <button onclick="appendValue('3')">3</button>
        <button onclick="appendValue('+')">+</button>

        <!-- Row 5 -->
        <button onclick="appendValue('0')" style="grid-column: span 2;">0</button>
        <button onclick="appendValue('.')">.</button>
        <button onclick="calculate()" class="equal">=</button>
    </div>
    <div id="history" class="history"></div>
</div>

<script>
let display = document.getElementById('display');
let history = document.getElementById('history');
let currentInput = '';
let shouldReset = false;

function appendValue(value) {
    if (value === '=' || value === 'Enter') { calculate(); return; }
    if (shouldReset && !['+', '-', '*', '/', '×', '÷'].includes(value)) { currentInput = ''; shouldReset = false; }

    // ± toggle
    if (value === '±') {
        if (currentInput.startsWith('-')) currentInput = currentInput.slice(1);
        else currentInput = '-' + currentInput;
        display.textContent = currentInput;
        return;
    }

    // Prevent multiple decimals
    if (value === '.' && currentInput.slice(-1) === '.') return;

    currentInput += value;
    display.textContent = currentInput;
}

function clearDisplay() {
    currentInput = '';
    display.textContent = '0';
}

function calculate() {
    try {
        let expression = currentInput.replace(/×/g,'*').replace(/÷/g,'/').replace(/−/g,'-');
        let result;
        if (expression.includes('%')) {
            result = eval(expression.replace('%','/100'));
        } else {
            result = eval(expression);
        }
        if(result === Infinity || result === -Infinity) throw "Division by zero";
        history.innerHTML += `<div>${currentInput} = ${result}</div>`;
        display.textContent = result;
        currentInput = result.toString();
        shouldReset = true;
        history.scrollTop = history.scrollHeight;
    } catch {
        display.textContent = 'Error';
        currentInput = '';
        shouldReset = true;
    }
}

// Keyboard support
document.addEventListener('keydown', e => {
    if (!isNaN(e.key) || ['+', '-', '*', '/','.'].includes(e.key)) appendValue(e.key);
    if (e.key === 'Enter') calculate();
    if (e.key === 'Backspace') { currentInput = currentInput.slice(0,-1); display.textContent = currentInput || '0'; }
    if (e.key === 'Escape') clearDisplay();
});

// Theme toggle
function toggleTheme() { document.body.classList.toggle('dark'); }
</script>
</body>
</html>
